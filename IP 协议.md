# IP 协议



## IP地址的基础知识

在用TCP/IP 通信时，用IP地址识别主机和路由器。为了保证正常通信，有必要为每个设备配置正确的IP地址。在互联网通信中，全世界都必须设定正确的IP地址。否则，根本无法实现正常的通信。因此，IP地址就像是 TCP/IP 通信的一块基石。



### IP 地址的定义

IP地址(IPv4地址)由32位正整数来表示。TCP/IP通信要求将这样的IP地址分配给每一个参与通信的主机。IP地址在计算机内部以二进制方式被处理。然而，由于人类社会并不习惯于采用二进制方式，需要采用一种特殊的标记方式。那就是将32位的IP地址以每8位为一组，分成4组，每组以“.”隔开，再将每组数转换为十进制数"。下面举例说明这一方法。

![image-20241228161649076](IP 协议.assets/image-20241228161649076.png)



### IP 地址由网络和主机两部分标识组成

IP地址由“网络标识(网络地址)”和“主机标识(主机地址)”两部分组成。

如图4.11所示，网络标识在数据链路的每个段配置不同的值。网络标识必须保证相互连接的每个段的地址不相重复。而相同段内相连的主机必须有相同的网络地址。IP地址的“主机标识”则不允许在同一个网段内重复出现。

![image-20241228165201307](IP 协议.assets/image-20241228165201307.png)





### IP 地址的分类

IP地址分为四个级别，分别为A类、B类、C类、D类。它根据IP地址中从第1位到第4位的比特列对其网络标识和主机标识进行区分。

- A类地址

  A类IP地址是首位以“0”开头的地址。从第1位到第8位是它的网络标识。

  用十进制表示的话，0.0.0.0~127.0.0.0是A类的网络地址。A类地址的后24位相当于主机标识。因此，一个网段内可容纳的主机地址上限为16，777，214个。

- B类地址

  B类IP地址是前两位为“10”的地址。从第1位到第16位是它的网络标识。

  用十进制表示的话，128.0.0.1~191.255.0.0是B类的网络地址。B类地址的后16位相当于主机标识。因此，一个网段内可容纳的主机地址上限为65，534个。

- C类地址

  C类IP地址是前三位为“110”的地址。从第1位到第24位是它的网络标识。

  用十进制表示的话，192.168.0.0~239.255.255.0是C类的网络地址。C类地址的后8位相当于主机标识。因此，一个网段内可容纳的主机地址上限为254 个。

- D类地址

  D类IP地址是前四位为“1110”的地址。从第1位到第32位是它的网络标识。

  用十进制表示的话，224.0.0.0~239.255.255.255是D类的网络地址。D类地址没有主机标识，常被用于多播。

  

### 广播地址

广播地址用于在**同一个链路中相互连接的主机之间发送数据包**。

当主机号全为 1 时，就表示该网络的广播地址。例如把 `172.20.0.0/16` 用二进制表示如下：

```plaintext
10101100.00010100.00000000.00000000
```

将这个地址的**主机部分全部改为 1**，则形成广播地址：

```plaintext
10101100.00010100.11111111.11111111
```

再将这个地址用十进制表示，则为 `172.20.255.255`。



**两种广播**

在本网络内的广播叫做本地广播。例如网络地址为192.168.0.0/24的情况下，广播地址是192.168.0.255。因为这个广播地址的IP包会被路由器屏蔽，所以不会到达 192.168.0.0/24 以外的其他链路上。

在不同网络之间的广播叫做直接广播。例如网络地址为192.168.0.0/24的主机向192.168.1.255/24的目标地址发送IP包。收到这个包的路由器，将数据转发给192.168.1.0/24，从而使得所有192.168.1.1~192.168.1.254 的主机都能收到这个包。

![image-20241229005825131](IP 协议.assets/image-20241229005825131.png)



### IP 多播

>同时发送提高效率

多播用于将包发送给特定组内的所有主机。由于其直接使用IP协议，因此也不存在可靠传输。

而随着多媒体应用的发展，对于向多台主机同时发送数据包，在效率上的要求也日益提高。在电视会议系统中对于1对N、N对N通信的需求明显上升。而具体实现上往往采用复制1对1通信的数据，将其同时发送给多个主机的方式。在人们使用多播功能之前，一直采用广播的方式。那时广播将数据发给所有终端主机，再由这些主机IP之上的一层去判断是否有必要接收数据。是则接收，否则丢弃。

然而这种方式会给那些毫无关系的网络或主机带来影响，造成网络上很多不必要的流量。况且由于广播无法穿透路由，若想给其他网段发送同样的包，就不得不采取另一种机制。因此，多播这种既可以穿透路由器，又可以实现只给那些必要的组发送数据包的技术就成为必选之路了。

![image-20241229012009270](IP 协议.assets/image-20241229012009270.png)







### 子网掩码

>分类造成浪费?

一个IP地址只要确定了其分类，也就确定了它的网络标识和主机标识。例如A类地址前8位(除首位“0”还有7位)、B类地址前16位(除首位“10”还有14位)、C类地址前24位(除首位“110”还有21位)分别是它们各自的网络标识部分。
由此，按照每个分类所表示的网络标识的范围如下所示，

![image-20241228174124328](IP 协议.assets/image-20241228174124328.png)

用“1”表示IP网络地址的比特范围，用“0”表示IP主机地址范围。将它们以十进制表示，如下所示。其中“1”的部分是网络地址部分，“0”的部分是主机地址部分。

![image-20241228174316945](IP 协议.assets/image-20241228174316945.png)

网络标识相同的计算机必须同属于同一个链路。例如，架构B类IP网络时，理论上一个链路内允许6万5千多台计算机连接。然而，在实际网络架构当中一般不会有在同一个链路上连接6万5千多台计算机的情况。因此，这种网络结构实际上是不存在的。
因此，直接使用A类或B类地址，确实有些浪费。随着互联网的覆盖范围逐渐增大，网络地址会越来越不足以应对需求，直接使用A类、B类、C类地址就更加显得浪费资源。为此，人们已经开始一种新的组合方式以减少这种浪费。





>子网与子网掩码

现在，一个卫地址的网络标识和主机标识已不再受限于该地址的类别，而是由一个叫做“子网掩码”的识别码通过子网网络地址细分出比A类、B类、C类更小粒度的网络。这种方式实际上就是将原来A类、B类C类等分类中的主机地址部分用作子网地址，可以将原网络分为多个物理网络的一种机制。

自从引人了子网以后，一个IP地址就有了两种识别码。一是IP地址本身，另一个是表示网络部的子网掩码。子网掩码用二进制方式表示的话，也是一个32位的数字。它对应IP地址网络标识部分的位全部为“1”，对应IP地址主机标识的部分则全部为“0”。由此，一个IP地址可以不再受限于自己的类别，而是可以用这样的子网掩码自由地定位自己的网络标识长度。当然，子网掩码必须是IP地址的首位开始连续的“1”

>最初提出子网掩码时曾允许出现不连续的子网掩码，但现在基本不允许出现这种情况。

对于子网掩码，目前有两种表示方式。以172.20.100.52的前26位是网络地址的情况为例，以下是其中一种表示方法，它将IP地址与子网掩码的地址分别用两行来表示。

![image-20241228180932261](IP 协议.assets/image-20241228180932261.png)

另一种表示方式如下所示。它在每个IP地址后面追加网络地址的位数用"/"隔开。

![image-20241228180957227](IP 协议.assets/image-20241228180957227.png)

不难看出，在第二种方式下记述网络地址时可以省略后面的“0”。例如172.20.0.0/16 跟 172.20/16 其实是一个意思。

![image-20241228181410915](IP 协议.assets/image-20241228181410915.png)





### CIDR 与VLSM